local a=require('data.min')local b=require('battery.min')local c=require('code.min')local d=require('image_sprite_block.min')local e=require('plain_text.min')TEXT_FLAG=0x0a;IMAGE_SPRITE_BLOCK=0x0d;TAP_SUBS_MSG=0x10;a.parsers[TEXT_FLAG]=e.parse_plain_text;a.parsers[IMAGE_SPRITE_BLOCK]=d.parse_image_sprite_block;a.parsers[TAP_SUBS_MSG]=c.parse_code;TAP_MSG=0x09;function handle_tap()pcall(frame.bluetooth.send,string.char(TAP_MSG))end;function print_text()local f=0;for g in a.app_data[TEXT_FLAG].string:gmatch("([^\n]*)\n?")do if g~=""then frame.display.text(g,1,f*60+1)f=f+1 end end end;function app_loop()frame.display.text(" ",1,1)frame.display.show()local h=0;while true do rc,err=pcall(function()local i=a.process_raw_items()frame.sleep(0.005)if i>0 then if a.app_data[TEXT_FLAG]~=nil and a.app_data[TEXT_FLAG].string~=nil then print_text()end;if a.app_data[IMAGE_SPRITE_BLOCK]~=nil then local j=a.app_data[IMAGE_SPRITE_BLOCK]if j.current_sprite_index>0 then if j.progressive_render or j.active_sprites==j.total_sprites then for k=1,j.active_sprites do local l=j.sprites[k]local m=j.sprite_line_height*(k-1)if k==1 then d.set_palette(l.num_colors,l.palette_data)end;frame.display.bitmap(401,m+1,l.width,2^l.bpp,0,l.pixel_data)end;frame.display.show()end end end;if a.app_data[TAP_SUBS_MSG]~=nil then if a.app_data[TAP_SUBS_MSG].value==1 then frame.imu.tap_callback(handle_tap)else frame.imu.tap_callback(nil)end;a.app_data[TAP_SUBS_MSG]=nil end;frame.display.show()end;frame.sleep(0.005)h=b.send_batt_if_elapsed(h,180)frame.sleep(0.1)end)if rc==false then print(err)frame.display.text(" ",1,1)frame.display.show()frame.sleep(0.04)break end end end;app_loop()